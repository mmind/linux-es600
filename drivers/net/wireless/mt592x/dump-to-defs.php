#!/usr/bin/php
<?php

$regs = array();
$bits = array();

/* read header, very ugly but works */
foreach(explode("\n", file_get_contents("host.h")) as $line)
{
  /* for now registers are easily identifiable via the comment after them */
  if(preg_match("/^#define (.+?)\s+(0x.+)\s+\/\*(.+)\*\//", $line, $matches))
  {
    $regs[hexdec(substr($matches[2], 2))] = array
    (
      "name" => $matches[1],
      "desc" => trim($matches[3])
    );
    continue;
  }

  if(preg_match("/^#define (.+?)\s+(\(\(\d+ \<\<.+)$/", $line, $matches)
    || preg_match("/^#define (.+?)\s+(\(\d+ \<\<.+)$/", $line, $matches)
    || preg_match("/^#define (.+?)\s+(\d.+)/", $line, $matches)
    || preg_match("/^#define (.+?)\s+(\d+)/", $line, $matches))
  {
    $regIdent = substr($matches[1], 0, strpos($matches[1], "_"));
    if(!isset($bits[$regIdent]))
      $bits[$regIdent] = array();

    if($matches[2] == "0")
      continue;

    $val = @eval("return ".$matches[2].";");
    if($val == "")
    {
      echo "could not parse ".$line."\n";
      continue;
    }

    $bits[$regIdent][] = array
    (
      "name" => $matches[1],
      "text" => $matches[2],
      "val"  => $val
    );
  }
}

/* {reset to standby} */
$src = "spi sending 8 bytes: 0xd0 0x00 0x04 0x80 0x00 0x40 0x40 0x00 
spi sending 4 bytes: 0xd0 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x7f 0x00 0x00 
spi sending 4 bytes: 0x78 0x01 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x78 0x01 0x04 0x80 0x00 0x00 0x00 0x00 
";

/* {standby to idle} */
$src = "spi sending 8 bytes: 0x3c 0x00 0x04 0x80 0x20 0x00 0x00 0x00 
spi sending 4 bytes: 0x94 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x94 0x00 0x04 0x80 0x00 0x00 0x00 0x00 
spi sending 4 bytes: 0x68 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x08 0x00 0x07 0x00 
spi sending 8 bytes: 0x68 0x00 0x04 0x80 0x08 0x00 0x07 0x00 
spi sending 4 bytes: 0x6c 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x19 0x00 0x00 
spi sending 8 bytes: 0x6c 0x00 0x04 0x80 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x3c 0x00 0x04 0x80 0x08 0x01 0x00 0x00 
spi sending 8 bytes: 0x3c 0x00 0x04 0x80 0x08 0xff 0x00 0x00 
";

/* {power-on sequence} */
$src = "spi sending 4 bytes: 0x6c 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x6c 0x00 0x04 0x80 0x00 0x1e 0x00 0x00 
spi sending 4 bytes: 0x68 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x0f 0x00 
spi sending 8 bytes: 0x68 0x00 0x04 0x80 0x00 0x00 0x07 0x00 
spi sending 4 bytes: 0x04 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 4 bytes: 0x08 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 4 bytes: 0xe8 0x03 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
";

$src = "spi sending 4 bytes: 0x04 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x00 0x00 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x00 0x00 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x00 0x40 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x00 0x40 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x00 0x44 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x00 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x40 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x60 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x70 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x72 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x00 0x7a 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x01 0x7a 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x01 0x7a 0x4c 0x10 
spi sending 8 bytes: 0x50 0x01 0x04 0x80 0x01 0x7a 0x4c 0x10 
spi sending 8 bytes: 0x0c 0x00 0x04 0x80 0x03 0x29 0xb1 0xfc 
spi sending 8 bytes: 0x04 0x00 0x04 0x80 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x30 0x01 0x04 0x80 0x1e 0x50 0x00 0x00 
spi sending 8 bytes: 0x34 0x01 0x04 0x80 0x0a 0x16 0x06 0x06 
spi sending 8 bytes: 0x9c 0x01 0x04 0x80 0x50 0x00 0x00 0x00 
spi sending 8 bytes: 0x50 0x00 0x04 0x80 0x73 0x80 0x00 0x20 
spi sending 8 bytes: 0xc0 0x00 0x04 0x80 0x00 0x00 0x78 0x04 
spi sending 8 bytes: 0xd8 0x00 0x04 0x80 0x23 0x11 0x70 0x07 
spi sending 8 bytes: 0x00 0x01 0x04 0x80 0x00 0x20 0x68 0x07 
spi sending 4 bytes: 0xf4 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0xf4 0x00 0x04 0x80 0x10 0x00 0x00 0x00 
spi sending 8 bytes: 0xec 0x00 0x04 0x80 0x1f 0x00 0x00 0x00 
spi sending 8 bytes: 0x14 0x01 0x04 0x80 0x22 0x22 0x22 0x22 
spi sending 8 bytes: 0x18 0x01 0x04 0x80 0x20 0x00 0x00 0x00 
spi sending 8 bytes: 0x7c 0x00 0x04 0x80 0x00 0x00 0x00 0xc0 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x00 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x10 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x30 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x01 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x11 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x31 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x02 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x12 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x32 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x03 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x13 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x33 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x04 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x14 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x34 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x05 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x15 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x35 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x06 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x16 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x36 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x07 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x17 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x37 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x08 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x18 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x38 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x09 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x19 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x39 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x0a 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x1a 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x3a 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x0b 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x1b 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x3b 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x80 
spi sending 4 bytes: 0x0c 0x00 0x00 0x00 
spi sending 4 bytes: 0x00 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x21 0x59 0x91 0x00 
spi sending 8 bytes: 0x38 0x00 0x04 0x80 0x1c 0x00 0x00 0x00 
spi sending 4 bytes: 0x34 0x00 0x04 0x00 
spi received 4 bytes: 0x00 0x00 0x00 0x00 
spi received 4 bytes: 0x3c 0x00 0x00 0x00 
spi sending 4 bytes: 0x6c 0x00 0x04 0x00 
spi received 8 bytes: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
spi sending 8 bytes: 0x6c 0x00 0x04 0x80 0x00 0x19 0x00 0x00 
spi sending 8 bytes: 0x04 0x02 0x04 0x80 0x31 0x06 0x00 0x00 
spi sending 8 bytes: 0x40 0x02 0x04 0x80 0x90 0xd1 0x00 0x00 
spi sending 8 bytes: 0x44 0x02 0x04 0x80 0xa0 0x80 0x00 0x00 
spi sending 8 bytes: 0x48 0x02 0x04 0x80 0x99 0x66 0x00 0x00 
spi sending 8 bytes: 0xc0 0x02 0x04 0x80 0x92 0x19 0x00 0x00 
spi sending 8 bytes: 0xb8 0x02 0x04 0x80 0x3a 0x14 0x00 0x00 
spi sending 8 bytes: 0xc4 0x02 0x04 0x80 0xee 0x66 0x00 0x00 
spi sending 8 bytes: 0x60 0x02 0x04 0x80 0x1f 0x1c 0x00 0x00 
spi sending 8 bytes: 0x64 0x02 0x04 0x80 0xff 0x38 0x00 0x00 
spi sending 8 bytes: 0xf8 0x03 0x04 0x80 0xbf 0xd0 0x00 0x00 
spi sending 8 bytes: 0xfc 0x03 0x04 0x80 0x57 0xda 0x00 0x00 
spi sending 8 bytes: 0x68 0x02 0x04 0x80 0x98 0x6c 0x00 0x00 
spi sending 8 bytes: 0x6c 0x02 0x04 0x80 0x29 0x10 0x00 0x00 
spi sending 8 bytes: 0x74 0x02 0x04 0x80 0x3b 0x12 0x00 0x00 
spi sending 8 bytes: 0x3c 0x02 0x04 0x80 0x09 0x3f 0x00 0x00 
spi sending 8 bytes: 0x5c 0x02 0x04 0x80 0x70 0x00 0x00 0x00 
spi sending 8 bytes: 0xf8 0x02 0x04 0x80 0x46 0x10 0x00 0x00 
spi sending 8 bytes: 0x70 0x02 0x04 0x80 0x3b 0x60 0x00 0x00 
spi sending 8 bytes: 0x54 0x02 0x04 0x80 0xd1 0x14 0x00 0x00 
spi sending 8 bytes: 0xac 0x02 0x04 0x80 0x0a 0xb9 0x00 0x00 
spi sending 8 bytes: 0xb0 0x02 0x04 0x80 0xa2 0x07 0x00 0x00 
spi sending 8 bytes: 0x20 0x03 0x04 0x80 0xb9 0xd0 0x00 0x00 
spi sending 8 bytes: 0xfc 0x02 0x04 0x80 0x9b 0x9b 0x00 0x00 
spi sending 8 bytes: 0x28 0x03 0x04 0x80 0x69 0x36 0x00 0x00 
spi sending 8 bytes: 0x10 0x02 0x04 0x80 0x96 0x65 0x00 0x00 
spi sending 8 bytes: 0x14 0x02 0x04 0x80 0x65 0x59 0x00 0x00 
spi sending 8 bytes: 0x2c 0x03 0x04 0x80 0x53 0x8a 0x00 0x00 
spi sending 8 bytes: 0xec 0x03 0x04 0x80 0x9f 0x03 0x00 0x00 
spi sending 8 bytes: 0xe4 0x03 0x04 0x80 0x5c 0xf5 0x00 0x00 
spi sending 8 bytes: 0x0c 0x03 0x04 0x80 0x80 0x20 0x00 0x00 
spi sending 8 bytes: 0x00 0x03 0x04 0x80 0x21 0x58 0x00 0x00 
spi sending 8 bytes: 0x04 0x03 0x04 0x80 0xa5 0x08 0x00 0x00 
spi sending 8 bytes: 0xf4 0x03 0x04 0x80 0x37 0x06 0x00 0x00 
spi sending 8 bytes: 0xbc 0x02 0x04 0x80 0x0a 0x34 0x00 0x00 
spi sending 8 bytes: 0x4c 0x02 0x04 0x80 0x0d 0x26 0x00 0x00 
spi sending 8 bytes: 0x9c 0x03 0x04 0x80 0xb7 0x00 0x00 0x00 
spi sending 8 bytes: 0x18 0x02 0x04 0x80 0x59 0x96 0x00 0x00 
spi sending 8 bytes: 0x34 0x02 0x04 0x80 0x18 0x40 0x00 0x00 
spi sending 8 bytes: 0xf4 0x02 0x04 0x80 0x08 0x99 0x00 0x00 
spi sending 8 bytes: 0xf0 0x03 0x04 0x80 0xb2 0x56 0x00 0x00 
";

$transm = explode("\n", $src);

for($cnt = 0; $cnt < count($transm); $cnt++)
{
  if(trim($transm[$cnt]) == "")
    continue;

  $vals = explode(" ", $transm[$cnt]);
  $line = $transm[$cnt];

  $reg = substr($vals[5], 2).substr($vals[4], 2);
  $params = substr($vals[7], 2).substr($vals[6], 2);

  /* skip all non-register stuff, i.e. access that do not read/write 4 byte */
  if(substr($vals[6], 2) != "04")
  {
    echo "transmission, that is not an access to a register:\n";
    echo $line."\n";
    continue;
  }

  /* read operation, advance the counter and get content from there */
  if(!(hexdec($params) & (1 << 15)))
  {
    $entry = array("mode" => "read");
    $cnt++;
    $vals = explode(" ", $transm[$cnt]);

    if(count($vals) < 11)
    {
      $cnt++;
      $vals = array_merge(array("dummy","dummy","dummy","dummy"), explode(" ", $transm[$cnt]));
    }
  }
  elseif((hexdec($params) & (1 << 15)) && count($vals) < 11)
  {
    $entry = array("mode" => "write");
    $cnt++;
    $vals = array_merge(array("dummy","dummy","dummy","dummy"), explode(" ", $transm[$cnt]));
  }
  else
  {
    $entry = array("mode" => "write");
  }

  $val = "";

  if(count($vals) >= 11)
    for($i = 0; $i < 4; $i ++)
      $val.= substr($vals[11-$i], 2) ;
  $val = hexdec($val);

  if(!isset($regs[hexdec($reg)]))
  {
    echo "no data found for register ".$reg."\n";
    echo $line."\n";
    continue;
  }

  $regData = $regs[hexdec($reg)];
  $rtmp = substr($regData["name"], strpos($regData["name"], "_")+1);

  $entry["register"] = $regData["name"];
  $entry["reg-desc"] = $regData["desc"];

  if(!isset($bits[$rtmp]))
  {
    $entry["valstr"] = "0";
    $entry["unmatched"] = "0x".dechex($val);
  }
  else
  {
    $matchStr = array();
    $matchVal = 0;
    foreach($bits[$rtmp] as $v)
    {
      $val = (int)$val;

      if(($val & $v["val"]) == $v["val"])
      {
        $matchStr[] = $v["name"];
        $matchVal |= $v["val"];
      }
    }

    $entry["valstr"] = count($matchStr) > 0 ? implode(" | ", $matchStr) : 0;
    $entry["unmatched"] = "0x".dechex($val ^ $matchVal);
  }

print_r($entry);



}


?>
